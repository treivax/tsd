# Makefile pour le module RETE
# Usage: make [target]

.PHONY: help test coverage clean validate build format lint

# Affichage de l'aide par dÃ©faut
help:
	@echo "ğŸ¯ Module RETE - Commandes disponibles:"
	@echo ""
	@echo "  build      - Compiler tous les packages"
	@echo "  test       - ExÃ©cuter tous les tests avec couverture"
	@echo "  coverage   - GÃ©nÃ©rer le rapport de couverture HTML"
	@echo "  validate   - Valider la structure du projet"
	@echo "  format     - Formater le code Go"
	@echo "  lint       - Analyser le code avec golint"
	@echo "  clean      - Nettoyer les artefacts temporaires"
	@echo ""
	@echo "ğŸ“ Structure des rÃ©pertoires:"
	@echo "  pkg/       - Packages publics"
	@echo "  internal/  - Packages internes"
	@echo "  test/      - Tests et couverture"
	@echo "  docs/      - Documentation"
	@echo "  scripts/   - Scripts utilitaires"

# Compilation
build:
	@echo "ğŸ”¨ Compilation des packages..."
	@go build ./pkg/...
	@go build ./internal/...
	@echo "âœ… Compilation terminÃ©e"

# Tests complets avec couverture
test:
	@./scripts/run_tests.sh

# GÃ©nÃ©ration de couverture uniquement
coverage:
	@echo "ğŸ“Š GÃ©nÃ©ration de la couverture..."
	@go test -coverprofile=test/coverage/coverage.out .
	@go tool cover -html=test/coverage/coverage.out -o test/coverage/reports/coverage.html
	@echo "âœ… Rapport disponible: test/coverage/reports/coverage.html"

# Validation de la structure
validate:
	@./scripts/validate_structure.sh

# Formatage du code
format:
	@echo "âœ¨ Formatage du code Go..."
	@go fmt ./...
	@echo "âœ… Code formatÃ©"

# Analyse statique (si golint est disponible)
lint:
	@echo "ğŸ” Analyse du code..."
	@if command -v golint >/dev/null 2>&1; then \
		golint ./pkg/... ; \
		golint ./internal/... ; \
	else \
		echo "âš ï¸  golint non installÃ©, utilisation de go vet..."; \
		go vet ./... ; \
	fi
	@echo "âœ… Analyse terminÃ©e"

# Nettoyage
clean:
	@./scripts/clean.sh

# Tests rapides (sans couverture)
test-quick:
	@echo "âš¡ Tests rapides..."
	@go test -short ./test/unit/...
	@echo "âœ… Tests rapides terminÃ©s"

# Installation des dÃ©pendances de dÃ©veloppement
dev-deps:
	@echo "ğŸ“¦ Installation des outils de dÃ©veloppement..."
	@go install golang.org/x/lint/golint@latest || echo "âš ï¸  golint installation Ã©chouÃ©e"
	@echo "âœ… Outils installÃ©s"
