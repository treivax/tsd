<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RETE Monitoring Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1>üî• RETE Monitoring Dashboard</h1>
                <div class="header-status">
                    <div class="status-indicator" id="connectionStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Connecting...</span>
                    </div>
                    <div class="timestamp" id="lastUpdate">Last update: --</div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="dashboard-nav">
            <button class="nav-btn active" data-tab="overview">üìä Overview</button>
            <button class="nav-btn" data-tab="performance">‚ö° Performance</button>
            <button class="nav-btn" data-tab="network">üèóÔ∏è Network</button>
            <button class="nav-btn" data-tab="alerts">üö® Alerts</button>
            <button class="nav-btn" data-tab="system">üíª System</button>
        </nav>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="metrics-grid">
                    <!-- Key Performance Indicators -->
                    <div class="metric-card kpi">
                        <h3>üéØ Facts/sec</h3>
                        <div class="metric-value" id="factsPerSec">0</div>
                        <div class="metric-trend" id="factsPerSecTrend">--</div>
                    </div>

                    <div class="metric-card kpi">
                        <h3>‚ö° Tokens/sec</h3>
                        <div class="metric-value" id="tokensPerSec">0</div>
                        <div class="metric-trend" id="tokensPerSecTrend">--</div>
                    </div>

                    <div class="metric-card kpi">
                        <h3>üé≤ Rules/sec</h3>
                        <div class="metric-value" id="rulesPerSec">0</div>
                        <div class="metric-trend" id="rulesPerSecTrend">--</div>
                    </div>

                    <div class="metric-card kpi">
                        <h3>‚è±Ô∏è Avg Latency</h3>
                        <div class="metric-value" id="avgLatency">0ms</div>
                        <div class="metric-trend" id="avgLatencyTrend">--</div>
                    </div>
                </div>

                <!-- Real-time Charts -->
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>üìà Throughput Over Time</h3>
                        <canvas id="throughputChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <h3>‚è±Ô∏è Latency Distribution</h3>
                        <canvas id="latencyChart"></canvas>
                    </div>
                </div>

                <!-- Network Summary -->
                <div class="network-summary">
                    <h3>üèóÔ∏è Network Status</h3>
                    <div class="network-stats">
                        <div class="stat">
                            <span class="stat-label">Total Nodes:</span>
                            <span class="stat-value" id="totalNodes">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Active Nodes:</span>
                            <span class="stat-value" id="activeNodes">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Total Facts:</span>
                            <span class="stat-value" id="totalFacts">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Error Rate:</span>
                            <span class="stat-value" id="errorRate">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Tab -->
            <div id="performance" class="tab-content">
                <div class="performance-metrics">
                    <h2>üöÄ Performance Optimizations</h2>

                    <!-- IndexedStorage Stats -->
                    <div class="perf-section">
                        <h3>üîç Indexed Storage</h3>
                        <div class="perf-grid">
                            <div class="perf-metric">
                                <span class="perf-label">Cache Hit Ratio:</span>
                                <span class="perf-value" id="indexCacheHit">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Total Indexes:</span>
                                <span class="perf-value" id="totalIndexes">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Lookup Speed:</span>
                                <span class="perf-value" id="lookupSpeed">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- HashJoin Stats -->
                    <div class="perf-section">
                        <h3>‚ö° Hash Join Engine</h3>
                        <div class="perf-grid">
                            <div class="perf-metric">
                                <span class="perf-label">Join Cache Hits:</span>
                                <span class="perf-value" id="joinCacheHits">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Join Cache Misses:</span>
                                <span class="perf-value" id="joinCacheMisses">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Avg Join Time:</span>
                                <span class="perf-value" id="avgJoinTime">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Evaluation Cache Stats -->
                    <div class="perf-section">
                        <h3>üß† Evaluation Cache</h3>
                        <div class="perf-grid">
                            <div class="perf-metric">
                                <span class="perf-label">Cache Size:</span>
                                <span class="perf-value" id="evalCacheSize">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Hit Ratio:</span>
                                <span class="perf-value" id="evalHitRatio">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Evictions:</span>
                                <span class="perf-value" id="evalEvictions">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Token Propagation Stats -->
                    <div class="perf-section">
                        <h3>üîÑ Token Propagation</h3>
                        <div class="perf-grid">
                            <div class="perf-metric">
                                <span class="perf-label">Queue Size:</span>
                                <span class="perf-value" id="queueSize">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Parallel Efficiency:</span>
                                <span class="perf-value" id="parallelEfficiency">--</span>
                            </div>
                            <div class="perf-metric">
                                <span class="perf-label">Worker Utilization:</span>
                                <span class="perf-value" id="workerUtilization">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>üìä Component Performance</h3>
                        <canvas id="performanceChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <h3>üéØ Cache Hit Ratios</h3>
                        <canvas id="cacheChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Network Tab -->
            <div id="network" class="tab-content">
                <div class="network-view">
                    <h2>üèóÔ∏è RETE Network Topology</h2>

                    <div class="network-controls">
                        <button class="control-btn" id="refreshNetwork">üîÑ Refresh</button>
                        <button class="control-btn" id="exportNetwork">üì• Export</button>
                        <select id="nodeFilter" class="control-select">
                            <option value="all">All Nodes</option>
                            <option value="root">Root Nodes</option>
                            <option value="alpha">Alpha Nodes</option>
                            <option value="beta">Beta Nodes</option>
                            <option value="terminal">Terminal Nodes</option>
                        </select>
                    </div>

                    <div class="network-graph" id="networkGraph">
                        <div class="network-placeholder">
                            <div class="placeholder-content">
                                <div class="loading-spinner"></div>
                                <p>Loading network topology...</p>
                            </div>
                        </div>
                    </div>

                    <div class="node-details" id="nodeDetails">
                        <h3>Node Details</h3>
                        <p>Select a node to view details</p>
                    </div>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts" class="tab-content">
                <div class="alerts-view">
                    <h2>üö® Alerts & Monitoring</h2>

                    <div class="alerts-controls">
                        <button class="control-btn primary" id="createAlert">‚ûï Create Rule</button>
                        <button class="control-btn" id="refreshAlerts">üîÑ Refresh</button>
                        <select id="alertFilter" class="control-select">
                            <option value="all">All Alerts</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>

                    <!-- Active Alerts -->
                    <div class="alerts-section">
                        <h3>üî• Active Alerts</h3>
                        <div class="alerts-list" id="activeAlerts">
                            <div class="alert-placeholder">No active alerts</div>
                        </div>
                    </div>

                    <!-- Alert Rules -->
                    <div class="alerts-section">
                        <h3>üìã Alert Rules</h3>
                        <div class="rules-list" id="alertRules">
                            <div class="rule-placeholder">No alert rules configured</div>
                        </div>
                    </div>

                    <!-- Alert History -->
                    <div class="alerts-section">
                        <h3>üìä Alert History</h3>
                        <div class="history-chart">
                            <canvas id="alertHistoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Tab -->
            <div id="system" class="tab-content">
                <div class="system-metrics">
                    <h2>üíª System Metrics</h2>

                    <div class="system-grid">
                        <div class="system-card">
                            <h3>üß† Memory Usage</h3>
                            <div class="memory-stats">
                                <div class="memory-bar">
                                    <div class="memory-used" id="memoryUsed" style="width: 0%"></div>
                                </div>
                                <div class="memory-details">
                                    <span id="memoryText">0 MB / 0 MB</span>
                                    <span id="memoryPercent">0%</span>
                                </div>
                            </div>
                        </div>

                        <div class="system-card">
                            <h3>üîÑ Goroutines</h3>
                            <div class="metric-big" id="goroutineCount">0</div>
                        </div>

                        <div class="system-card">
                            <h3>üóëÔ∏è GC Count</h3>
                            <div class="metric-big" id="gcCount">0</div>
                        </div>

                        <div class="system-card">
                            <h3>‚è±Ô∏è Uptime</h3>
                            <div class="metric-big" id="uptime">0s</div>
                        </div>
                    </div>

                    <!-- System Charts -->
                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3>üìä Memory Usage Over Time</h3>
                            <canvas id="memoryChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <h3>üîÑ Goroutines Over Time</h3>
                            <canvas id="goroutinesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="alertRuleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Alert Rule</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="alertRuleForm">
                    <div class="form-group">
                        <label for="ruleName">Rule Name:</label>
                        <input type="text" id="ruleName" required>
                    </div>
                    <div class="form-group">
                        <label for="ruleDescription">Description:</label>
                        <textarea id="ruleDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="ruleCondition">Condition:</label>
                        <input type="text" id="ruleCondition" placeholder="e.g. cpu_usage > 80" required>
                    </div>
                    <div class="form-group">
                        <label for="ruleThreshold">Threshold:</label>
                        <input type="number" id="ruleThreshold" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="ruleSeverity">Severity:</label>
                        <select id="ruleSeverity">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn secondary" id="cancelRule">Cancel</button>
                        <button type="submit" class="btn primary">Create Rule</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="dashboard.js"></script>
</body>
</html>
