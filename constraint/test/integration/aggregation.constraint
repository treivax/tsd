// Test 5 : Agrégation (AccumulateNode)
// Types pour tests d'agrégation
type Portfolio : <id: string, owner: string, type: string, created: number>
type Asset : <id: string, portfolio_id: string, value: number, type: string, risk_level: number>
type Trade : <id: string, portfolio_id: string, asset_id: string, amount: number, price: number, timestamp: number>

// Agrégation SUM - somme des valeurs
{p: Portfolio} / SUM(a: Asset / a.portfolio_id == p.id ; a.value) > 100000 ==> flagHighPortfolio(p.id)

// Agrégation COUNT - nombre d'éléments
{p: Portfolio} / COUNT(a: Asset / a.portfolio_id == p.id) >= 10 ==> applyDiversification(p.id)

// Agrégation AVG - moyenne
{p: Portfolio} / AVG(a: Asset / a.portfolio_id == p.id ; a.risk_level) < 5 ==> recommendConservative(p.id)

// Agrégation MIN - valeur minimale
{p: Portfolio} / MIN(a: Asset / a.portfolio_id == p.id ; a.value) > 1000 ==> validateMinimum(p.id)

// Agrégation MAX - valeur maximale
{p: Portfolio} / MAX(a: Asset / a.portfolio_id == p.id ; a.value) <= 500000 ==> approveRiskLimit(p.id)

// Agrégation COUNT avec Trade
{p: Portfolio} / COUNT(t: Trade / t.portfolio_id == p.id) > 100 ==> analyzeTradingPattern(p.id)
