// Test opérateurs arithmétiques dans jointures beta
type Account : <id: string, balance: number, credit_limit: number, fees: number>
type Transaction : <id: string, account_id: string, amount: number, type: string>

rule r1 : {a: Account, t: Transaction} / a.id == t.account_id AND t.amount + a.fees <= a.balance ==> valid_transaction(a.id, t.id)
rule r2 : {a: Account, t: Transaction} / a.id == t.account_id AND a.balance + a.credit_limit >= t.amount * 2 ==> safe_transaction(a.id, t.id)
rule r3 : {a: Account, t: Transaction} / a.id == t.account_id AND (a.balance - t.amount) / a.credit_limit > 0.1 ==> conservative_transaction(a.id, t.id)

Account(id:ACC001, balance:1000, credit_limit:500, fees:10)
Account(id:ACC002, balance:2500, credit_limit:1000, fees:5)
Account(id:ACC003, balance:500, credit_limit:200, fees:15)
Transaction(id:TXN001, account_id:ACC001, amount:900, type:debit)
Transaction(id:TXN002, account_id:ACC002, amount:1200, type:debit)
Transaction(id:TXN003, account_id:ACC003, amount:600, type:debit)
Transaction(id:TXN004, account_id:ACC001, amount:50, type:debit)
