# ğŸ›¡ï¸ Scan de VulnÃ©rabilitÃ©s - TSD

## ğŸ“‹ Vue d'Ensemble

TSD utilise **govulncheck** pour dÃ©tecter automatiquement les vulnÃ©rabilitÃ©s de sÃ©curitÃ© dans les dÃ©pendances Go et la bibliothÃ¨que standard.

### Outils de SÃ©curitÃ©

| Outil | Fonction | FrÃ©quence |
|-------|----------|-----------|
| **govulncheck** | Scan vulnÃ©rabilitÃ©s CVE dans dÃ©pendances | Chaque commit (CI) |
| **gosec** | Analyse statique de sÃ©curitÃ© du code | Chaque commit (CI) |
| **go vet** | Analyse statique standard Go | Chaque commit (CI) |

---

## ğŸš€ Utilisation

### Installation des Outils

```bash
# Installer tous les outils de sÃ©curitÃ©
make deps-dev

# VÃ©rifier l'installation
govulncheck --version
gosec --version
```

### ExÃ©cution Locale

```bash
# Scan complet de sÃ©curitÃ© (gosec + govulncheck)
make security-scan

# Scan vulnÃ©rabilitÃ©s uniquement
make security-vulncheck

# Analyse statique uniquement
make security-gosec
```

### IntÃ©gration dans le Workflow

```bash
# Validation complÃ¨te (inclut security-scan)
make validate

# CI/CD
make ci
```

---

## ğŸ” govulncheck - DÃ©tails

### Qu'est-ce que govulncheck ?

**govulncheck** est l'outil officiel de l'Ã©quipe Go pour dÃ©tecter les vulnÃ©rabilitÃ©s connues dans :
- La bibliothÃ¨que standard Go
- Les dÃ©pendances directes (listÃ©es dans `go.mod`)
- Les dÃ©pendances transitives (indirectes)

**Base de donnÃ©es** : https://vuln.go.dev/

### Fonctionnement

govulncheck analyse :
1. Le fichier `go.mod` pour identifier les dÃ©pendances
2. Le code source pour dÃ©tecter l'utilisation rÃ©elle des fonctions vulnÃ©rables
3. Signale uniquement les vulnÃ©rabilitÃ©s **effectivement utilisÃ©es**

**Avantage** : RÃ©duit les faux positifs en vÃ©rifiant si le code vulnÃ©rable est rÃ©ellement appelÃ©.

### Sortie d'Exemple

#### âœ… Aucune VulnÃ©rabilitÃ©

```
$ govulncheck ./...
No vulnerabilities found.
```

#### âŒ VulnÃ©rabilitÃ©s DÃ©tectÃ©es

```
=== Symbol Results ===

Vulnerability #1: GO-2025-4175
    Improper application of excluded DNS name constraints in crypto/x509
  More info: https://pkg.go.dev/vuln/GO-2025-4175
  Standard library
    Found in: crypto/x509@go1.24.4
    Fixed in: crypto/x509@go1.24.11
    Example traces found:
      #1: constraint/parser.go:5461:22: constraint.ParseReader calls x509.Certificate.Verify

Your code is affected by 1 vulnerability from the Go standard library.
```

### InterprÃ©tation des RÃ©sultats

| Statut | Action Requise |
|--------|----------------|
| **No vulnerabilities found** | âœ… Aucune action |
| **Vulnerability found** | ğŸ”´ **CRITIQUE** - Mise Ã  jour requise |
| **Vulnerability in imports** | âš ï¸ Surveiller - Non utilisÃ©e directement |

---

## ğŸ”„ RÃ©solution des VulnÃ©rabilitÃ©s

### 1. VulnÃ©rabilitÃ©s Standard Library

**Cause** : Version Go obsolÃ¨te

**Solution** :
```bash
# Mettre Ã  jour Go vers la version corrigÃ©e
# Exemple : Si vulnÃ©rabilitÃ© corrigÃ©e dans go1.24.11
go version  # VÃ©rifier version actuelle

# Installer Go 1.24.11+
# Linux:
sudo rm -rf /usr/local/go
wget https://go.dev/dl/go1.24.11.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.24.11.linux-amd64.tar.gz

# VÃ©rifier
go version

# Re-scanner
govulncheck ./...
```

### 2. VulnÃ©rabilitÃ©s DÃ©pendances Directes

**Cause** : Version de dÃ©pendance obsolÃ¨te dans `go.mod`

**Solution** :
```bash
# Identifier la dÃ©pendance
govulncheck -json ./... | jq '.osv.affected[].package'

# Mettre Ã  jour la dÃ©pendance
go get -u github.com/example/package@v2.0.0

# Nettoyer
go mod tidy

# VÃ©rifier
govulncheck ./...
```

### 3. VulnÃ©rabilitÃ©s DÃ©pendances Transitives

**Cause** : DÃ©pendance d'une de nos dÃ©pendances

**Solution** :
```bash
# Option 1 : Forcer mise Ã  jour transitive
go get -u github.com/parent/package

# Option 2 : Utiliser replace directive (temporaire)
# go.mod:
replace vulnerable/package => safe/package v1.2.3

# Option 3 : Attendre mise Ã  jour upstream
# CrÃ©er une issue sur le repo de la dÃ©pendance
```

---

## ğŸ¤– IntÃ©gration CI/CD

### Workflow GitHub Actions

Le scan est intÃ©grÃ© dans `.github/workflows/go-conventions.yml` :

```yaml
security-scan:
  name: ğŸ”’ Scan de SÃ©curitÃ©
  runs-on: ubuntu-latest

  steps:
    - name: ğŸ“¦ Checkout du code
      uses: actions/checkout@v4

    - name: ğŸ¹ Configuration Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'

    - name: ğŸ›¡ï¸ Scan de sÃ©curitÃ© Go (gosec)
      uses: securecodewarrior/github-action-gosec@master
      with:
        args: './...'

    - name: ğŸ” Vulnerability Scan (govulncheck)
      run: |
        go install golang.org/x/vuln/cmd/govulncheck@latest
        govulncheck ./...
```

### Comportement CI

| ScÃ©nario | RÃ©sultat CI | Action |
|----------|-------------|--------|
| Aucune vulnÃ©rabilitÃ© | âœ… PASSE | Continuer |
| VulnÃ©rabilitÃ© dÃ©tectÃ©e | âŒ Ã‰CHEC | **Bloquer le merge** |
| govulncheck non installÃ© | âŒ Ã‰CHEC | Installer outils |

**Important** : Le CI **bloque automatiquement** le merge si des vulnÃ©rabilitÃ©s sont dÃ©tectÃ©es.

---

## ğŸ“Š Modes d'ExÃ©cution

### Mode Strict (Production)

```bash
# Ã‰choue si vulnÃ©rabilitÃ© trouvÃ©e
govulncheck ./...
```

**RecommandÃ© pour** :
- CI/CD
- Validation prÃ©-commit
- Releases

### Mode Informatif (DÃ©veloppement)

```bash
# Affiche mais ne bloque pas
govulncheck ./... || true
```

**RecommandÃ© pour** :
- DÃ©veloppement local
- Investigation
- Audit de sÃ©curitÃ©

### Mode Verbose

```bash
# Afficher tous les dÃ©tails
govulncheck -show verbose ./...
```

**Affiche** :
- VulnÃ©rabilitÃ©s affectant le code
- VulnÃ©rabilitÃ©s dans imports non utilisÃ©es
- VulnÃ©rabilitÃ©s dans modules non utilisÃ©s

---

## ğŸ“ˆ MÃ©triques et Reporting

### Rapport JSON

```bash
# GÃ©nÃ©rer rapport JSON
govulncheck -json ./... > vulns.json

# Analyser avec jq
cat vulns.json | jq '.osv | select(.id != null)'
```

### IntÃ©gration avec Outils Tiers

```bash
# Exporter pour SARIF (GitHub Security)
govulncheck -format sarif ./... > results.sarif

# Upload vers GitHub Security
# Via GitHub Actions
```

---

## ğŸ”’ Bonnes Pratiques

### DÃ©veloppement

1. **ExÃ©cuter rÃ©guliÃ¨rement** :
   ```bash
   # Avant chaque commit
   make security-scan
   ```

2. **Mettre Ã  jour Go** :
   ```bash
   # VÃ©rifier version recommandÃ©e
   go version
   
   # Mettre Ã  jour vers derniÃ¨re stable
   ```

3. **Surveiller dÃ©pendances** :
   ```bash
   # Lister dÃ©pendances
   go list -m all
   
   # VÃ©rifier mises Ã  jour
   go list -u -m all
   ```

### CI/CD

1. **Scan Ã  chaque commit** âœ…
2. **Bloquer merge si vulnÃ©rabilitÃ©** âœ…
3. **Notification Ã©quipe** (Ã  configurer)
4. **Dashboard sÃ©curitÃ©** (optionnel)

### Production

1. **Scan quotidien** automatisÃ©
2. **Alertes** en cas de nouvelle CVE
3. **Process de patching** dÃ©fini
4. **Documentation** des exceptions

---

## ğŸš¨ Gestion des VulnÃ©rabilitÃ©s

### Processus de Triage

1. **DÃ©tection** : govulncheck signale vulnÃ©rabilitÃ©
2. **Ã‰valuation** : Analyser impact et criticitÃ©
3. **Priorisation** :
   - ğŸ”´ Critique : Patch immÃ©diat
   - ğŸŸ  Majeure : Patch < 7 jours
   - ğŸŸ¡ Mineure : Patch < 30 jours
4. **Correction** : Mise Ã  jour dÃ©pendances
5. **VÃ©rification** : Re-scan aprÃ¨s correction
6. **Documentation** : Tracker dans changelog

### CriticitÃ©

| Niveau | CVSS Score | DÃ©lai Correction | Exemple |
|--------|------------|------------------|---------|
| ğŸ”´ **Critique** | 9.0-10.0 | < 24h | RCE, Injection SQL |
| ğŸŸ  **Majeure** | 7.0-8.9 | < 7 jours | XSS, CSRF |
| ğŸŸ¡ **Mineure** | 4.0-6.9 | < 30 jours | Info disclosure |
| âšª **Faible** | 0.1-3.9 | Opportuniste | DoS mineur |

---

## ğŸ“š Ressources

### Documentation Officielle

- **govulncheck** : https://go.dev/blog/vuln
- **Base de donnÃ©es** : https://vuln.go.dev/
- **GitHub Repository** : https://github.com/golang/vuln
- **Package** : https://pkg.go.dev/golang.org/x/vuln/cmd/govulncheck

### TSD SpÃ©cifique

- **Makefile** : Voir targets `security-*`
- **CI Workflow** : `.github/workflows/go-conventions.yml`
- **Standards** : `.github/prompts/common.md`

### Support

- **Issues** : Rapporter problÃ¨mes sur GitHub
- **Discussion** : Utiliser Discussions pour questions
- **SÃ©curitÃ©** : Voir `SECURITY.md` pour vulnÃ©rabilitÃ©s privÃ©es

---

## âš¡ TL;DR - Quick Start

```bash
# 1. Installer outils
make deps-dev

# 2. Scanner vulnÃ©rabilitÃ©s
make security-vulncheck

# 3. Si vulnÃ©rabilitÃ©s trouvÃ©es
# â†’ Mettre Ã  jour Go vers version corrigÃ©e
# â†’ Relancer scan

# 4. Validation complÃ¨te
make validate
```

**En cas de vulnÃ©rabilitÃ© critique** : Ne pas merger avant correction.

---

**DerniÃ¨re mise Ã  jour** : DÃ©cembre 2025  
**Maintenu par** : Ã‰quipe TSD Security
