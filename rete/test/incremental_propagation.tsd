# Test de propagation incrémentale multi-niveaux
# Vérifie la propagation séquentielle User -> User+Order -> User+Order+Product

type User(id: string, age: number)
type Order(id: string, user_id: string, product_id: string)
type Product(id: string, name: string)

# Règle avec 3 niveaux de jointure et conditions étagées
rule r1 : {u: User, o: Order, p: Product} / u.id == o.user_id AND o.product_id == p.id AND u.age >= 18 ==> incremental_propagation_match(u.id, o.id, p.id)

# Faits de test pour la propagation incrémentale
# Ces faits seront ajoutés séquentiellement pour tester la propagation

User(id:U1, age:25)
Order(id:O1, user_id:U1, product_id:P1)
Product(id:P1, name:TestProduct)

# Fait qui ne doit PAS matcher (user_id incorrect)
Order(id:O2, user_id:U999, product_id:P1)
